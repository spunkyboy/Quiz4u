<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Quiz Admin - Add Question</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="css/reset.css">
  <!--prevent  caching with meta tags-->
  <meta http-equiv="Cache-Control" content="no-store" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
</head>
<body class="admin-content">
  <button class="adminLogoutBtn" id="logoutBtn">Logout</button>
  <h1>Add New Quiz Question</h1>
  <form id="quizForm">
    <label>
      Question:<br />
      <input type="text" id="question" required />
    </label>
    <br /><br />
    <label>
      Options (comma separated):<br />
      <input type="text" id="options" required placeholder="Option1, Option2, Option3, Option4" />
    </label>
    <br /><br />
    <label>
      Correct Answer:<br />
      <input type="text" id="answer" required />
    </label>
    <br /><br />
    <button type="submit">Add Question</button>
  </form>

  <p id="resultMsg"></p>

  <button id="loadQuestionsBtn">Load All Questions</button>
  <div id="questionsContainer"></div>


  <script>


const loadQuestionsBtn = document.getElementById('loadQuestionsBtn');
const questionsContainer = document.getElementById('questionsContainer');
const form = document.getElementById('quizForm');
const resultMsg = document.getElementById('resultMsg');

async function loadQuestions() {
  questionsContainer.innerHTML = '<h2 style="text-align: center;">Current Questions</h2>';

  try {
    const res = await fetch('https://quiz4u.onrender.com/api/questions');
    if (!res.ok) throw new Error('Failed to fetch questions');
    const questions = await res.json();

    if (questions.length === 0) {
      questionsContainer.innerHTML += '<p>No questions yet.</p>';
      return;
    }

    questions.forEach(q => {
      const div = document.createElement('div');
      div.style.border = '1px solid #ccc';
      div.style.padding = '0.5rem';
      div.style.margin = '0.5rem 0';

      div.innerHTML = `
        <strong>Q:</strong> ${q.question} <br/>
        <strong>Options:</strong> ${q.options.join(', ')} <br/>
        <strong>Answer:</strong> ${q.answer} <br/>
        <button data-id="${q._id}">Delete</button>
      `;

      const deleteBtn = div.querySelector('button');
      deleteBtn.addEventListener('click', async () => {
        if (!confirm('Are you sure you want to delete this question?')) return;
        try {
          const deleteRes = await fetch(`https://quiz4u.onrender.com/api/questions/${q._id}`, {
            method: 'DELETE',
          });
          if (!deleteRes.ok) throw new Error('Failed to delete');
          alert('Question deleted');
          loadQuestions(); // refresh list
        } catch (err) {
          alert('Error deleting question: ' + err.message);
        }
      });

      questionsContainer.appendChild(div);
    });
  } catch (error) {
    resultMsg.style.color = 'red';
    resultMsg.textContent = 'Error loading questions: ' + error.message;
  }
}

// Load questions only when button clicked
loadQuestionsBtn.addEventListener('click', loadQuestions);

// Add new question (same as before)
form.addEventListener('submit', async (e) => {
  e.preventDefault();

  const question = document.getElementById('question').value.trim();
  const optionsInput = document.getElementById('options').value.trim();
  const answer = document.getElementById('answer').value.trim();

  const options = optionsInput.split(',').map(opt => opt.trim());

  try {
    const res = await fetch('https://quiz4u.onrender.com/api/questions', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ question, options, answer }),
    });

    const data = await res.json();

    if (res.ok) {
      resultMsg.style.color = 'green';
      resultMsg.textContent = data.message;
      form.reset();
      // Optionally auto-refresh questions if you want:
      // loadQuestions();
    } else {
      resultMsg.style.color = 'red';
      resultMsg.textContent = data.message || 'Failed to add question';
    }
  } catch (error) {
    resultMsg.style.color = 'red';
    resultMsg.textContent = 'Error: ' + error.message;
  }
});

//for logout out btton
// ✅ Page protection — redirect if not logged in
if (!localStorage.getItem('token')) {
  window.location.href = 'adminsigninsignup.html';
}

// ✅ Reload page if accessed via back/forward cache
window.onpageshow = function(event) {
  if (event.persisted || (window.performance && window.performance.navigation.type === 2)) {
    window.location.reload();
  }
};

// ✅ Logout button handler
document.getElementById('logoutBtn').addEventListener('click', () => {
  localStorage.removeItem('token');
  localStorage.removeItem('username');
  window.location.href = 'adminsigninsignup.html';
});

//for mobile scroll for all portrait content to show  and landscape all content to show

function setViewportHeight() {
  const vh = window.innerHeight * 0.01;
  document.documentElement.style.setProperty('--vh', `${vh}px`);
}
setViewportHeight();
window.addEventListener('resize', setViewportHeight);

  </script>

  
</body>
</html>
<-o- redeploy -->
